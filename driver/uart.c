/*------------------------------------------*/
/*	file: 		uart.c						*/
/*	revision:	0	Samuel Lee				*/
/*				1	Samuel Lee	2015-04-12	*/
/*											*/
/*			(C)2012-2015 IES-Lab			*/
/*			All rights reserved.			*/
/*------------------------------------------*/

/*------------------------------------------------------------------------------*/
/*    INCLUDES																	*/
/*------------------------------------------------------------------------------*/
#include "common.h"
#include "uart.h"


/*------------------------------------------------------------------------------*/
/*    MACROS																	*/
/*------------------------------------------------------------------------------*/

/*------------------------------------------------------------------------------*/
/*    GLOBAL VARS																*/
/*------------------------------------------------------------------------------*/

/*------------------------------------------------------------------------------*/
/*    GLOBAL FUNCTIONS (IMPLEMENTATIONS)											*/
/*------------------------------------------------------------------------------*/
/*!
* \brief Initialize the UART0.
*/
void uart0_init(void)
{	
	/*
			[UART0，1个起始位，8个数据位，1个停止位]
			
			Crystal: 24.0000MHz			

			Baud Rate			Register Value
			
			57600				TH=0xFF		TL=0xF3
			19200				TH=0xFF		TL=0xD9
			9600				TH=0xFF		TL=0xB2
			4800				TH=0xFF		TL=0x64
	*/

	/* 定时器2 */
	TH2=0xFF;							// 初值
	TL2=0xB2;

	/* 定时器2重载值 */
	RCAP2H=0xFF;						// 用于初值重载
	RCAP2L=0xB2;
	
	PCON=Reg_Field_Set(PCON,BIT7);		// PCON bit[7]:		UART0波特率/2功能禁止

	/* T2CON(定时器2控制寄存器)*/
	RCLK0=1;
	TCLK0=1;
	
	/* SCON0(UART0控制寄存器) */
	SCON0=0x50;
	ES0 = 0;	
	TI0 = 1;
	TR2=1;								// 启动定时器2
	
}	

/* end */